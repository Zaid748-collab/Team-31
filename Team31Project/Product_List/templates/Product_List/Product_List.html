{% extends "base.html" %}
{% load static %}

{% block title %}Product List{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/Product_List.css' %}">
{% endblock %}

{% block content %}
<div class="product-page container">
  <h2 class="page-title">Available Products</h2>

  <div class="filter-container">
    <input type="text" id="searchInput" placeholder="Search products...">
    
    <select id="categoryFilter">
      <option value="all">All Categories</option>
      <option value="GPU">GPU</option>
      <option value="Motherboard">Motherboard</option>
      <option value="CPU">CPU</option>
      <option value="Storage">Storage</option>
      <option value="RAM">RAM</option>
    </select>
  </div>

  <div class="product-grid" id="productGrid">
    {% for product in products %}
      <div class="product-card" data-name="{{ product.name|lower }}" data-category="{{ product.type }}">
        
        <div class="product-image">
          {% if product.image_url %}
            <img src="{{ product.image_url }}" alt="{{ product.name }}">
          {% else %}
            <div class="placeholder-image">No Image</div>
          {% endif %}
        </div>

        <h3 class="product-name">{{ product.name }}</h3>

        <div class="product-info">
          <p class="product-meta">
            Stock: {{ product.quantity_in_stock }}<br>
            Category: {{ product.type }}
          </p>
        </div>

        <form method="POST" action="{% url 'add_to_basket' product.id %}" class="product-action">
          {% csrf_token %}
          <button type="submit" class="add-basket-btn">Add to Basket</button>
        </form>
      </div>
    {% empty %}
      <p class="no-products">No products available.</p>
    {% endfor %}
  </div>
  
  <p id="noResultsMessage" style="display:none; text-align:center; margin-top:20px;">No matching products found.</p>

</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('searchInput');
    const categoryFilter = document.getElementById('categoryFilter');
    const cards = document.querySelectorAll('.product-card');
    const noResultsMessage = document.getElementById('noResultsMessage');

    function filterProducts() {
      const query = searchInput.value.toLowerCase();
      const selectedCategory = categoryFilter.value;
      let visibleCount = 0;

      cards.forEach(card => {
        const name = card.getAttribute('data-name');
        const category = card.getAttribute('data-category');

        const matchesSearch = name.includes(query);
        const matchesCategory = selectedCategory === 'all' || category === selectedCategory;

        if (matchesSearch && matchesCategory) {
          card.style.display = 'flex'; 
          visibleCount++;
        } else {
          card.style.display = 'none'; 
        }
      });

      noResultsMessage.style.display = visibleCount === 0 ? 'block' : 'none';
    }

    searchInput.addEventListener('input', filterProducts);
    categoryFilter.addEventListener('change', filterProducts);
  });
</script>

  <div class="product-grid">
    {% for product in products %}
      <div class="product-card">
        <div class="product-image">
          {% if product.image_url %}
            <img src="{{ product.image_url }}" alt="{{ product.name }}">
          {% else %}
            <div class="placeholder-image">No Image</div>
          {% endif %}
        </div>

        <h3 class="product-name">{{ product.name }}</h3>

        <div class="product-info">
          <p class="product-meta">
            Stock: {{ product.quantity_in_stock }}<br>
            Category: {{ product.type }}
          </p>
        </div>

        <form method="POST" action="{% url 'add_to_basket' product.id %}" class="product-action">
          {% csrf_token %}
          <button type="submit" class="add-basket-btn">Add to Basket</button>
        </form>
      </div>
    {% empty %}
      <p class="no-products">No products available.</p>
    {% endfor %}
  </div>
</div>

{% endblock %}
